<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/main.css"/>
    <title>My Books Library</title>
</head>

<body class="body-library-archive">
  <a href="/" class="return-button">Return to Home</a>

  <div class="counter-box" onmouseover="expandCounterBox()" onmouseout="collapseCounterBox()">
    <span id="book-counter"><%= listBooks.length  %></span> books read
    <div class="books-per-year">
    </div>
  </div>


 

    <div class="box-archive">

        <h1 class="archive-h1"> My Library</h1>

        <!-- <div class="row-archive">
         <div class="column-archive"> -->

           <div id ="my-library-archive-bg-box" class = "visible">
                    <input type="text" id="search-input" placeholder="Search...">
                    <ul id="search-suggestions"></ul>

                     <% listBooks.forEach(function(book, index) { %>
                      
                      <div class="my-library-archive-books-box <% if (index >= 5) { %>hidden<% } %>">
                        <span class="book-info">
                        <%= book.title %> by <%= book.author %>
                      </span>

                        <form action="/delete" method="post" class="delete-form">
                          <input type="hidden" name="deleteItemId" value="<%= book.id %>">
                          <button class="delete-button" type="submit">Delete</button>
                        </form>  
                        
   
                      </div>
                      <% }); %>     
            </div>

            <% if (listBooks.length > 5) { %>
                 <button id="show-more-button" type="button" onclick="handleShowMoreClick()">Show More</button>
            <% } %> 
                
          </div>
        </div>
    </div>
  <script>

// Books counter Event Listener
      document.addEventListener("DOMContentLoaded", function() {
          function updateBookCounter() {
              var counterElement = document.getElementById("book-counter");

              counterElement.textContent = listBooks.length;
      }
          updateBookCounter();
        });

// Expand counter box
  function expandCounterBox() {
  // Calculate books per year and update the content of the books-per-year div
  const booksPerYear = calculateBooksPerYear();
  const booksPerYearHTML = Object.entries(booksPerYear).map(([year, count]) => `<div>${year}: ${count}</div>`).join('');
  document.querySelector('.books-per-year').innerHTML = booksPerYearHTML;
}

// Calculate books read per year
function calculateBooksPerYear() {
  // Initialize an object to store books per year
  const booksPerYear = {};

  // Loop through the list of books and count books per year
  listBooks.forEach(book => {
    const year = book.recency.split('-')[0]; // Extract year from recency field
    if (!booksPerYear[year]) {
      booksPerYear[year] = 1;
    } else {
      booksPerYear[year]++;
    }
  });

  return booksPerYear;
}

function collapseCounterBox() {
  // Clear the content of the books-per-year div
  document.querySelector('.books-per-year').innerHTML = '';
}

// Books counter Current Year Event Listener
      document.addEventListener("DOMContentLoaded", function() {
          function updateBookCounter() {
              var counterElement = document.getElementById("book-counter");

              counterElement.textContent = listBooks.length;
      }
          updateBookCounter();
        });

// Onclick function of show-more-button
        function handleShowMoreClick() {
          var hiddenBooks = document.querySelectorAll('.my-library-archive-books-box.hidden');

            hiddenBooks.forEach(function(book) {
              book.classList.remove('hidden');
            });

            var showMoreButton = document.getElementById('show-more-button');
            showMoreButton.style.display = 'none'; // Hide the button once all books are visible
  }

// Event listener for search bar matching
  document.addEventListener("DOMContentLoaded", function() {
    var searchInput = document.getElementById("search-input");
    var books = document.querySelectorAll(".my-library-archive-books-box");

    searchInput.addEventListener("input", function() {
      var searchText = searchInput.value.toLowerCase();

      books.forEach(function(book) {
        var title = book.textContent.toLowerCase();
        if (title.includes(searchText)) {
          book.style.display = "block";
        } else {
          book.style.display = "none";
        }
      });
    });
  });
    </script>
</body>


<%- include('footer.ejs'); -%>
